"use strict";angular.module("aksturApp",["ngCookies","ngResource","ngSanitize","ngRoute","firebase","ui.bootstrap","ngAnimate"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/createNewTask/:dateId",{templateUrl:"views/createnewtask.html",controller:"CreatenewtaskCtrl",resolve:{currentUser:["simpleLogin",function(a){return a.$getCurrentUser()}]}}).when("/mainView",{templateUrl:"views/mainview.html",controller:"MainviewCtrl",resolve:{currentUser:["simpleLogin",function(a){return a.$getCurrentUser()}]}}).when("/taskedit/Date/:dateId/task/:taskId",{templateUrl:"views/taskedit.html",controller:"TaskeditCtrl",resolve:{currentUser:["simpleLogin",function(a){return a.$getCurrentUser()}]}}).when("/ordersDump/:dateId",{templateUrl:"views/ordersdump.html",controller:"OrdersdumpCtrl",resolve:{currentUser:["simpleLogin",function(a){return a.$getCurrentUser()}]}}).otherwise({redirectTo:"/"})}]).value("fbUrl","https://devakstur.firebaseio.com/").value("dumpUrl","https://devakstur.firebaseio.com/dump/").factory("simpleLogin",["$firebaseSimpleLogin","fbUrl",function(a,b){var c=new Firebase(b);return console.log("login"+a(c)),a(c)}]).run(function(){FastClick.attach(document.body)}),angular.module("aksturApp").controller("MainCtrl",["$scope","simpleLogin","$location","fbUrl",function(a,b,c,d){var e=new Firebase(d+".info/connected");e.on("value",function(b){b.val()===!0&&(a.online=!1)}),a.login=function(){console.log("func fired"),b.$login("password",{email:"s@2.is",password:1234,rememberMe:!0}).then(function(a){console.log("logged in as",a.uid,a.email),c.path("/mainView")},function(b){a.error=b,console.log("Login Failed",b),a.loginfaile=!0})},a.login()}]),angular.module("aksturApp").controller("CreatenewtaskCtrl",["$scope","Initializer","$firebase","$location","$filter","currentUser","$routeParams","fbUrl","dumpUrl",function(a,b,c,d,e,f,g,h){f||d.path("/"),a.d=g.dateId,a.aksturT="Senda",a.efni="Nei",a.gata="",a.defTask={},a.defTask.usermail=f.email,a.defTask.creationTime=e("date")(Date.now(),"yyyy-MM-dd HH:mm:ss"),a.backToday=e("date")(Date.now(),"dd-MMM"),a.defTask.wideTime="idag",a.defTask.car="Litill",a.defTask.outofhouse="NO",b.mapsInitialized.then(function(){a.location="";var b=new google.maps.places.Autocomplete($("#Gata")[0],{componentRestrictions:{country:"is"}});google.maps.event.addListener(b,"place_changed",function(){var c=b.getPlace();a.defTask.lat=c.geometry.location.lat(),a.defTask.lng=c.geometry.location.lng(),a.defTask.street=c.name}),a.taskRec=function(){a.defTask.taskModified="",a.defTask.modifEmail="",a.defTask.aksturT=a.aksturT,a.defTask.efni=a.efni,a.defTask.delivered="NO",a.defTask.checked="NO",a.defTask.priority="12",console.log("def task "+a.defTask.deliveryTime);var b=c(new Firebase(h+a.d+"/"));b.$push(a.defTask).then(function(){d.path("/mainView")})}})}]),angular.module("aksturApp").controller("MainviewCtrl",["$scope","Initializer","$firebase","$filter","$location","currentUser","simpleLogin","fbUrl",function(a,b,c,d,e,f,g,h){f||e.path("/"),a.url=h,a.value=d("date")(Date.now(),"yyyy-MM-dd"),a.user=f.email,a.logout=function(){g.$logout(),console.log("loged Out!"),e.path("#/")},a.alerts=[],a.isMobileDevice=!0,"bill1@ispan.is"!==a.user&&(a.isMobileDevice=!1);var i=new Firebase(h+"car/");b.mapsInitialized.then(function(){function b(){console.log("moving undone");var a;a=1===moment().isoWeekday()?d("date")(new Date(moment(Date.now()).subtract(3,"days")),"yyyy-MM-dd"):d("date")(new Date(moment(Date.now()).subtract(1,"days")),"yyyy-MM-dd");var b=d("date")(Date.now(),"yyyy-MM-dd"),e={},f=c(new Firebase(h+b+"/"));console.log("today"+b);var g,i=c(new Firebase(h+a+"/")),j=i.$asArray();j.$loaded().then(function(){for(var a=0;a<j.length;a++)"NO"===j[a].delivered&&(e.aksturT=j[a].aksturT,e.creationTime=j[a].creationTime,e.lastModif=j[a].lastModif||" ",e.efni=j[a].efni,e.lat=j[a].lat,e.lng=j[a].lng,e.nafn=j[a].nafn,e.street=j[a].street,e.taskModified=j[a].taskModified,e.usermail=j[a].usermail,e.modifEmail=j[a].modifEmail,e.deliveryTime=j[a].deliveryTime,e.delivered=j[a].delivered,e.checked=j[a].checked,e.car=j[a].car,e.fulltxt=j[a].fulltxt,e.priority=j[a].priority,e.wideTime=j[a].wideTime,e.outofhouse=j[a].outofhouse,g=j[a].$id,f.$push(e).then(function(){i.$remove(g)}))})}function g(a){console.log("car position ",a);var b=new Firebase(h+"car/");b.set({lat:a.coords.latitude,lon:a.coords.longitude})}function j(){console.log("fail geo")}console.log("We'v got injection of a map");var k,l=null;a.velja=function(){var b=moment(a.value).add(1,"days");a.tomorrow=d("date")(new Date(b),"yyyy-MM-dd");var e=c(new Firebase(h+a.value+"/"));l=e.$asArray(),l.$loaded().then(function(){a.allTasksToday=l,console.log("list has "+l.length),console.log(l[1]);for(var b in a.markers)a.markers[b].setMap(null),console.log("inside Velja()");a.markers=[];for(var b=0;b<l.length;b++)"YES"===l[b].delivered||("P-Bill"===l[b].car?console.log("car",l[b].car):"V-Bill"===l[b].car?console.log("car",l[b].car):"Kerra"===l[b].car?console.log("car",l[b].car):"Sott"===l[b].car?console.log("car",l[b].car):o(l[b]))}),a.DateForm.$setPristine(),l.$watch(function(b){if("child_changed"===b.event){console.log("hello form watch");var d=c(new Firebase(h+a.value+"/"+b.key)).$asObject();d.$loaded().then(function(){a.alerts.push({msg:d.street+" - Hefur breyst"})}),a.closeAlert=function(b){a.alerts.splice(b,1)}}for(var e in a.markers)a.markers[e].setMap(null),console.log("inside  WATCH loop");a.markers=[];for(var e=0;e<l.length;e++)"YES"===l[e].delivered||("P-Bill"===l[e].car?console.log("car",l[e].car):"V-Bill"===l[e].car?console.log("car",l[e].car):"Kerra"===l[e].car?console.log("car",l[e].car):"Sott"===l[e].car?console.log("car",l[e].car):o(l[e]))});var f=c(new Firebase(h+a.tomorrow+"/")),g=f.$asArray();g.$loaded().then(function(){a.allTasksTomorrow=g})},b(),a.velja();var m={zoom:11,center:new google.maps.LatLng(64.1335,-21.8569),mapTypeId:google.maps.MapTypeId.ROADMAP};a.map=new google.maps.Map(document.getElementById("map"),m),a.markers=[];var n=new google.maps.InfoWindow,o=function(b){var c=new google.maps.Marker({id:b.$id,map:a.map,position:new google.maps.LatLng(b.lat,b.lng),title:b.street,icon:"images/"+b.priority+".png"});c.content='<a href="#/taskedit/Date/'+a.value+"/task/"+b.$id+'/" ><button  style="color:#2286ff; font-weight: bold;border-color:#2286ff"  class="btn btn-default btn-lg btn-block" ">&nbsp Sko√∞a &nbsp</button> </a>',google.maps.event.addListener(c,"click",function(){n.setContent('<h4><span style="color:#2c4db1">'+c.title+"</span></h4>"+c.content),n.open(a.map,c)}),a.markers.push(c)};if(a.openInfoWindow=function(a,b){a.preventDefault(),google.maps.event.trigger(b,"click")},a.delete=function(a){console.log(a)},a.edit=function(b){console.log("my ID/Date/"+a.value+"/task/"+b+"/"),e.path("taskedit/Date/"+a.value+"/task/"+b+"/")},a.editTomorrow=function(b){e.path("taskedit/Date/"+a.tomorrow+"/task/"+b+"/")},a.getCarPosition=function(){k=new google.maps.Marker({map:a.map,position:new google.maps.LatLng(64.111953,-21.85102900000004),icon:"images/pickup.png"}),i.on("value",function(a){console.log("geodata",a.val()),k.setPosition(new google.maps.LatLng(a.val().lat,a.val().lon))})},a.hideCarPosition=function(){i.off("value"),k.setMap(null)},"car1@ispan.is"==f.email)if(navigator.geolocation){navigator.geolocation.watchPosition(g,j,{maximumAge:5e3,enableHighAccuracy:!0,timeout:5e3})}else alert("enable geolocation ")})}]),angular.module("aksturApp").directive("googlePlaces",[function(){return{restrict:"E",replace:!0,scope:{location:"="},template:'<input id="google_places_ac" name="google_places_ac" type="text" class="input-block-level"/>',link:function(a){var b=new google.maps.places.Autocomplete($("#google_places_ac")[0],{});google.maps.event.addListener(b,"place_changed",function(){var c=b.getPlace();a.location=c.geometry.location.lat()+","+c.geometry.location.lng(),a.$apply(),console.log(a.location)})}}}]),angular.module("aksturApp").factory("Initializer",["$window","$q",function(a,b){var c=b.defer(),d="https://maps.googleapis.com/maps/api/js?key=AIzaSyBfcU0wMzZ0Pf17uhIThYVNwPv2wdcQAwM&libraries=places&callback=",e=function(a,b){var c=document.createElement("script");c.src=a+b,document.body.appendChild(c)};return a.googleMapsInitialized=function(){c.resolve()},e(d,"googleMapsInitialized"),{mapsInitialized:c.promise}}]),angular.module("aksturApp").controller("TaskeditCtrl",["$scope","$routeParams","$firebase","$location","$filter","currentUser","fbUrl",function(a,b,c,d,e,f,g){f||d.path("/");var h=b.dateId,i={},j=c(new Firebase(g+b.dateId+"/"+b.taskId)).$asObject();a.backToday=e("date")(Date.now(),"dd-MMM"),a.forDay=b.dateId;var k=c(new Firebase(g+b.dateId+"/")).$asArray();k.$loaded().then(function(){a.allTasks=k}),j.$loaded().then(function(){a.editTask=j}),a.delTask=function(){var a=c(new Firebase(g+b.dateId+"/"+b.taskId));a.$remove().then(function(){console.log("removed "),d.path("/mainView")})},a.taskRec=function(){var j=e("date")(Date.now(),"yyyy-MM-dd HH:mm:ss"),k=f.email;if(b.dateId===a.forDay)console.log("data parameter",a.forDay),a.editTask.taskModified=j,a.editTask.modifEmail=k,a.editTask.$save().then(function(){d.path("/mainView")});else{var l=c(new Firebase(g+h));l.$remove(a.editTask.$id);var m=c(new Firebase(g+a.forDay+"/"));i.aksturT=a.editTask.aksturT,i.creationTime=a.editTask.creationTime,i.lastModif=new Date,i.efni=a.editTask.efni,i.lat=a.editTask.lat,i.lng=a.editTask.lng,i.nafn=a.editTask.nafn,i.street=a.editTask.street,i.taskModified=j,i.usermail=a.editTask.usermail,i.modifEmail=k,i.deliveryTime=a.editTask.deliveryTime,i.delivered=a.editTask.delivered,i.checked=a.editTask.checked,i.car=a.editTask.car,i.fulltxt=a.editTask.fulltxt,i.priority=a.editTask.priority,i.wideTime=a.editTask.wideTime,i.outofhouse=a.editTask.outofhouse,m.$push(i).then(function(){console.log("akstur obj ",i),d.path("/mainView")})}}}]),angular.module("aksturApp").filter("trcolor",function(){return function(a){return 1==a?"color1":2==a?"color2":3==a?"color3":4==a?"color4":5==a?"color5":6==a?" color6 ":7==a?"color7":8==a?"color8":9==a?"color9":10==a?"color10":11==a?"color11":void 0}}),angular.module("aksturApp").filter("deliveredLine",function(){return console.log("Filter deliv"),function(a){return"YES"===a?"delivered":void 0}}),angular.module("aksturApp").controller("OrdersdumpCtrl",["$scope","$firebase","$filter","$location","currentUser","simpleLogin","fbUrl","dumpUrl","$routeParams",function(a,b,c,d,e,f,g,h,i){e||d.path("/"),a.value=i.dateId,console.log("date from route"+a.value),a.user=e.email,a.logout=function(){f.$logout(),console.log("loged Out!"),d.path("#/")},a.alerts=[],a.redirectAkstur=function(){console.log("Dumphere we redirecting  to AKSTRU a tab"),d.path("/mainView")},a.redirectPontunar=function(){console.log("Dump here we redirecting  to PONTUNAR  tab")};var j=null;a.velja=function(){var c=b(new Firebase(h+a.value+"/"));j=c.$asArray(),j.$loaded().then(function(){a.allTasksToday=j,console.log("list has "+j.length)}),j.$watch(function(c){if(console.log("hello form wathc"),"child_changed"===c.event){var d=b(new Firebase(h+a.value+"/"+c.key)).$asObject();d.$loaded().then(function(){a.alerts.push({msg:d.nafn+" - Hefur breyst"})}),a.closeAlert=function(b){a.alerts.splice(b,1)}}})},a.velja()}]),angular.module("aksturApp").filter("ready",function(){return function(a){return"YES"===a?"isready":void 0}});